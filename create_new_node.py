# Requires all 4 of the REST modules to be turned on
	
# HAL
# HTTP Basic Authentication
# RESTful Web Services
# Serialization

import requests
import json
import re

# Authentification information to create a new node
auth = ('admin', 'SDSI-2020-cve')
# Change host IP address if not it's not 172.17.0.2
host = 'http://172.17.0.2:8000'

url = host + '/entity/node/'

headers = {
  'Content-Type': 'application/hal+json',
  'Cache-Control': 'no-cache',
  'Accept': 'application/hal+json',
}

query = {
  '_format': 'hal_json',
}

data = {
  '_links': {'type': {'href': host + '/rest/type/node/article'}},
  'type': [{'target_id': 'article'}],
  'body': [{'value': 'Test body.'}],
  'title':[{'value': 'Test title'}],
}

# Using a post command to create a new node
response = requests.post(url,
                         params=query,
                         data=json.dumps(data).encode('utf-8'),
                         auth=auth,
                         headers=headers)

if response.status_code != 201:
    raise Exception(f"Node creation failed, response code: {response.status_code}")

# Parse the new node id from the response, print(response.text) to look at the response form
created_node_number = int(re.search(r'\d+', response.text[59: 63]).group())
print(f"Node created succesfully, your node number is {created_node_number}.")

